!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b(require("crypto"),require("buffer")):"function"==typeof define&&define.amd?define(["crypto","buffer"],b):"object"==typeof exports?exports.PUBNUB=b(require("crypto"),require("buffer")):a.PUBNUB=b(a.crypto,a.buffer)}(this,function(a,b){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){function d(a,b){return h.createHmac("sha256",new i(b,"utf8")).update(a).digest("base64")}function e(a){console.error(a)}function f(a){function b(a,b){g({message:a,payload:b})}var c,d,e,f=a.success||function(){},g=a.fail||function(){},h=a.mode||"GET",i=a.data||{},j={};i.pnsdk=l,"POST"===h&&(c=decodeURIComponent(a.url.pop())),e=k.build_url(a.url,i),e="/"+e.split("/").slice(3).join("/"),d=a.url[0].split("//")[1],j.url="http://"+d+e,j.method=h,j.body=c,Parse.Cloud.httpRequest(j).then(function(a){var c;try{c=JSON.parse(a.text)}catch(d){return void b("Bad JSON response",a.text)}f(c)},function(a){var c;try{c=JSON.parse(a.text),"object"==typeof c&&"error"in c&&c.error===!0?g(c):b("Network error",a.text)}catch(d){b("Network error",a.text)}})}function g(){function a(a){return h.createHash("sha256").update(a).digest("hex").slice(0,32)}var b="0123456789012345";return{encrypt:function(c,d){if(!d)return c;var e=JSON.stringify(c),f=h.createCipheriv("aes-256-cbc",a(d),b),g=f.update(e,"utf8","base64")+f["final"]("base64");return g||c},decrypt:function(c,d){var e;if(!d)return c;var f=h.createDecipheriv("aes-256-cbc",a(d),b);try{e=f.update(c,"base64","utf8")+f["final"]("utf8")}catch(g){return null}return JSON.parse(e)}}}var h=c(1),i=c(2).Buffer,j=c(3),k=c(4),l="PubNub-JS-Parse/"+j.version,m=function(){var a={};return{get:function(b){return a[b]},set:function(b,c){a[b]=c}}}(),n=function(a){a.xdr=f,a.db=m,a.error=a.error||e,a.hmac_SHA256=d,a.crypto_obj=g(),a.params={pnsdk:l};var b=function(a){return n(a)},c=k.PN_API(a);for(var h in c)c.hasOwnProperty(h)&&(b[h]=c[h]);return b.init=b,b.secure=b,b.subscribe=function(){throw Error("#subscribe() method is disabled in Parse.com environment")},b.ready(),b};n.init=n,n.unique=k.unique,n.secure=n,a.exports=n,a.exports.PNmessage=k.PNmessage},function(b,c){b.exports=a},function(a,c){a.exports=b},function(a,b){a.exports={name:"pubnub",preferGlobal:!1,version:"3.14.1",author:"PubNub <support@pubnub.com>",description:"Publish & Subscribe Real-time Messaging with PubNub",contributors:[{name:"Stephen Blum",email:"stephen@pubnub.com"}],bin:{},scripts:{test:"grunt test --force"},main:"./node.js/pubnub.js",browser:"./modern/dist/pubnub.js",repository:{type:"git",url:"git://github.com/pubnub/javascript.git"},keywords:["cloud","publish","subscribe","websockets","comet","bosh","xmpp","real-time","messaging"],dependencies:{agentkeepalive:"~0.2",lodash:"^4.1.0"},noAnalyze:!1,devDependencies:{"babel-core":"^6.5.2","babel-eslint":"^5.0.0","babel-plugin-transform-class-properties":"^6.5.2","babel-plugin-transform-flow-strip-types":"^6.5.0","babel-preset-es2015":"^6.5.0",chai:"^3.5.0",eslint:"^2.2.0","eslint-config-airbnb":"^6.0.2","eslint-plugin-flowtype":"^2.1.0","eslint-plugin-mocha":"^2.0.0","eslint-plugin-react":"^4.1.0","flow-bin":"^0.22.0",grunt:"^0.4.5","grunt-babel":"^6.0.0","grunt-contrib-clean":"^1.0.0","grunt-contrib-copy":"^0.8.2","grunt-contrib-uglify":"^0.11.1","grunt-env":"^0.4.4","grunt-eslint":"^18.0.0","grunt-flow":"^1.0.3","grunt-karma":"^0.12.1","grunt-mocha-istanbul":"^3.0.1","grunt-text-replace":"^0.4.0","grunt-webpack":"^1.0.11","imports-loader":"^0.6.5",isparta:"^4.0.0","json-loader":"^0.5.4",karma:"^0.13.21","karma-chai":"^0.1.0","karma-mocha":"^0.2.1","karma-phantomjs-launcher":"^1.0.0","karma-spec-reporter":"0.0.24","load-grunt-tasks":"^3.4.0",mocha:"^2.4.5",nock:"^1.1.0","node-uuid":"^1.4.7",nodeunit:"^0.9.0","phantomjs-prebuilt":"^2.1.4",proxyquire:"^1.7.4",sinon:"^1.17.2","uglify-js":"^2.6.1",underscore:"^1.7.0",webpack:"^1.12.13","webpack-dev-server":"^1.14.1"},bundleDependencies:[],license:"MIT",engine:{node:">=0.8"},files:["core","node.js","modern","CHANGELOG","FUTURE.md","LICENSE","README.md"]}},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(){return"x"+ ++t+ +new Date}function f(a,b){var c=[];return q["default"].each(a,function(a,d){b?a.search("-pnpres")<0&&d.subscribed&&c.push(a):d.subscribed&&c.push(a)}),c.sort()}function g(a,b){var c=[];return q["default"].each(a,function(a,d){b?a.search("-pnpres")<0&&d.subscribed&&c.push(a):d.subscribed&&c.push(a)}),c.sort()}function h(){u||(u=1,q["default"].each(v,function(a){a()}))}function i(a){var b=a||{apns:{}};return b.getPubnubMessage=function(){var a={};if(Object.keys(b.apns).length){a.pn_apns={aps:{alert:b.apns.alert,badge:b.apns.badge}};for(var c in b.apns)a.pn_apns[c]=b.apns[c];var d=["badge","alert"];for(var c in d)delete a.pn_apns[d[c]]}b.gcm&&(a.pn_gcm={data:b.gcm});for(var c in b)a[c]=b[c];var e=["apns","gcm","publish","channel","callback","error"];for(var c in e)delete a[e[c]];return a},b.publish=function(){var a=b.getPubnubMessage();b.pubnub&&b.channel&&b.pubnub.publish({message:a,channel:b.channel,callback:b.callback,error:b.error})},b}function j(a){function b(a){return a||(a={}),q["default"].each(wa,function(b,c){b in a||(a[b]=c)}),a}function c(a){var b=[];return q["default"].each(a,function(a,c){b.push(a)}),b}function d(a){return c(a).sort()}function i(a){var b="",c=d(a);for(var e in c){var f=c[e];b+=f+"="+q["default"].pamEncode(a[f]),e!=c.length-1&&(b+="&")}return b}function j(a,b,c){var d=!1;if("undefined"==typeof a)return b;if("number"==typeof a)d=!(a>C||0==a);else{if("boolean"==typeof a)return a?D:0;d=!0}return d?(c&&c("Presence Heartbeat value invalid. Valid range ( x > "+C+" or x = 0). Current Value : "+(b||C)),b||C):a}function l(a,b){return Ia.encrypt(a,b||Ba)||a}function n(a,b){return Ia.decrypt(a,b||Ba)||Ia.decrypt(a,Ba)||a}function p(){return clearTimeout(qa),!sa||sa>=500||1>sa||!f(na,!0).length&&!g(oa,!0).length?void(ta=!1):(ta=!0,void Ja.presence_heartbeat({callback:function(a){qa=q["default"].timeout(p,sa*B)},error:function(a){xa&&xa("Presence Heartbeat unable to reach Pubnub servers."+JSON.stringify(a)),qa=q["default"].timeout(p,sa*B)}}))}function r(){!ta&&p()}function s(a){if(ua){if(!ea.length)return}else{if(a&&(ea.sending=0),ea.sending||!ea.length)return;ea.sending=1}P(ea.shift())}function t(a){var b=0;return q["default"].each(g(oa),function(c){var d=oa[c];d&&(b++,(a||function(){})(d))}),b}function y(a){var b=0;return q["default"].each(f(na),function(c){var d=na[c];d&&(b++,(a||function(){})(d))}),b}function F(a,b,c){if("object"==("undefined"==typeof a?"undefined":k(a))){if(a.error){var d={};return a.message&&(d.message=a.message),a.payload&&(d.payload=a.payload),void(c&&c(d))}if(a.payload)return void(a.next_page?b&&b(a.payload,a.next_page):b&&b(a.payload))}b&&b(a)}function G(a,b){if("object"==("undefined"==typeof a?"undefined":k(a))&&a.error){var c={};return a.message&&(c.message=a.message),a.payload&&(c.payload=a.payload),void(b&&b(c))}b&&b(a)}function H(a,c,d,e){var c=a.callback||c,f=a.error||xa,g=za();e=e||{},e.auth||(e.auth=a.auth_key||V.getAuthKey());var h=[W.getStandardOrigin(),"v1","channel-registration","sub-key",V.getSubscribeKey()];h.push.apply(h,d),g&&(e.callback=g),P({callback:g,data:b(e),success:function(a){F(a,c,f)},fail:function(a){G(a,f)},url:h})}function I(){ya()||K(1,{error:"Offline. Please check your network settings."}),N&&clearTimeout(N),N=q["default"].timeout(I,B)}function J(){$&&Ja.time(function(a){M(function(){},a),a||K(1,{error:"Heartbeat failed to connect to Pubnub Servers.Please check your network settings."}),O&&clearTimeout(O),O=q["default"].timeout(J,Z)})}function K(a,b){ja&&ja(a,b),ja=null,clearTimeout(N),clearTimeout(O)}function L(a){var b=q["default"].rnow()-ga;return b-a/1e4}function M(a,b){function c(b){if(b){var c=b/1e4,e=(q["default"].rnow()-d)/2;ga=q["default"].rnow()-(c+e),a&&a(ga)}}var d=q["default"].rnow();b&&c(b)||Ja.time(c)}var N,O,P=a.xdr,Q=a.subscribe_key,R=a.publish_key,S=a.ssl,T=a.origin,U=a.auth_key,V=(new o["default"]).setAuthKey(U||"").setSubscribeKey(Q).setPublishKey(R),W=new m["default"](P,V,S,T),X=+a.windowing||x,Y=(+a.timeout||z)*B,Z=(+a.keepalive||A)*B,$=a.timecheck||0,_=a.noleave||0,aa=a.secret_key||"",ba=a.hmac_SHA256,ca=a.ssl?"s":"",da=function(){},ea=[],fa=!0,ga=0,ha=0,ia=0,ja=0,ka=a.restore||0,la=0,ma=!1,na={},oa={},pa={},qa=null,ra=j(a.heartbeat||a.pnexpires||0,a.error),sa=a.heartbeat_interval||ra/2-1,ta=!1,ua=a.no_wait_for_pending,va=a["compatible_3.5"]||!1,wa=a.params||{},xa=a.error||function(){},ya=a._is_online||function(){return 1},za=a.jsonp_cb||function(){return 0},Aa=a.db||{get:function(){},set:function(){}},Ba=a.cipher_key,Ca=a.uuid||!a.unique_uuid&&Aa&&Aa.get(V.getSubscribeKey()+"uuid")||"",Da=a.instance_id||!1,Ea="",Fa=a.shutdown,Ga="undefined"!=typeof a.use_send_beacon?a.use_send_beacon:!0,Ha=Ga?a.sendBeacon:null;2===ra&&(sa=1);var Ia=a.crypto_obj||{encrypt:function(a,b){return a},decrypt:function(a,b){return a}},Ja={LEAVE:function(a,c,d,e,f){var g,h,i={uuid:Ca,auth:d||V.getAuthKey()},j=W.nextOrigin(!1),e=e||function(){},k=f||function(){},l=za();if(a.indexOf(w)>0)return!0;if(va){if(!ca)return!1;if("0"==l)return!1}if(_)return!1;if("0"!=l&&(i.callback=l),Da&&(i.instanceid=Ea),g=[j,"v2","presence","sub_key",V.getSubscribeKey(),"channel",q["default"].encode(a),"leave"],h=b(i),Ha){var m=q["default"].buildURL(g,h);if(Ha(m))return e&&e({status:200,action:"leave",message:"OK",service:"Presence"}),!0}return P({blocking:c||ca,callback:l,data:h,success:function(a){F(a,e,k)},fail:function(a){G(a,k)},url:g}),!0},LEAVE_GROUP:function(a,c,d,e,f){var g,h,i={uuid:Ca,auth:d||V.getAuthKey()},j=W.nextOrigin(!1),e=e||function(){},k=f||function(){},l=za();if(a.indexOf(w)>0)return!0;if(va){if(!ca)return!1;if("0"==l)return!1}if(_)return!1;if("0"!=l&&(i.callback=l),a&&a.length>0&&(i["channel-group"]=a),Da&&(i.instanceid=Ea),g=[j,"v2","presence","sub_key",V.getSubscribeKey(),"channel",q["default"].encode(","),"leave"],h=b(i),Ha){var m=q["default"].buildURL(g,h);if(Ha(m))return e&&e({status:200,action:"leave",message:"OK",service:"Presence"}),!0}return P({blocking:c||ca,callback:l,data:h,success:function(a){F(a,e,k)},fail:function(a){G(a,k)},url:g}),!0},set_resumed:function(a){ma=a},get_cipher_key:function(){return Ba},set_cipher_key:function(a){Ba=a},raw_encrypt:function(a,b){return l(a,b)},raw_decrypt:function(a,b){return n(a,b)},get_heartbeat:function(){return ra},set_heartbeat:function(a,b){ra=j(a,ra,xa),sa=b||ra/2-1,2==ra&&(sa=1),da(),p()},get_heartbeat_interval:function(){return sa},set_heartbeat_interval:function(a){sa=a,p()},get_version:function(){return E},getGcmMessageObject:function(a){return{data:a}},getApnsMessageObject:function(a){var b={aps:{badge:1,alert:""}};for(var c in a)c[b]=a[c];return b},_add_param:function(a,b){wa[a]=b},channel_group:function Ka(a,b){var c,Ka,d=a.channel_group,b=b||a.callback,e=a.channels||a.channel,f=a.cloak,g=[],h={},i=a.mode||"add";if(d){var j=d.split(":");j.length>1?(c="*"===j[0]?null:j[0],Ka=j[1]):Ka=j[0]}c&&g.push("namespace")&&g.push(q["default"].encode(c)),g.push("channel-group"),Ka&&"*"!==Ka&&g.push(Ka),e?(q["default"].isArray(e)&&(e=e.join(",")),h[i]=e,h.cloak=fa?"true":"false"):"remove"===i&&g.push("remove"),"undefined"!=typeof f&&(h.cloak=f?"true":"false"),H(a,b,g,h)},channel_group_list_groups:function(a,b){var c;c=a.namespace||a.ns||a.channel_group||null,c&&(a.channel_group=c+":*"),Ja.channel_group(a,b)},channel_group_list_channels:function(a,b){return a.channel_group?void Ja.channel_group(a,b):xa("Missing Channel Group")},channel_group_remove_channel:function(a,b){return a.channel_group?a.channel||a.channels?(a.mode="remove",void Ja.channel_group(a,b)):xa("Missing Channel"):xa("Missing Channel Group")},channel_group_remove_group:function(a,b){return a.channel_group?a.channel?xa("Use channel_group_remove_channel if you want to remove a channel from a group."):(a.mode="remove",void Ja.channel_group(a,b)):xa("Missing Channel Group")},channel_group_add_channel:function(a,b){return a.channel_group?a.channel||a.channels?void Ja.channel_group(a,b):xa("Missing Channel"):xa("Missing Channel Group")},channel_group_cloak:function(a,b){return"undefined"==typeof a.cloak?void b(fa):(fa=a.cloak,void Ja.channel_group(a,b))},channel_group_list_namespaces:function(a,b){var c=["namespace"];H(a,b,c)},channel_group_remove_namespace:function(a,b){var c=["namespace",a.namespace,"remove"];H(a,b,c)},history:function(a,c){var c=a.callback||c,d=a.count||a.limit||100,e=a.reverse||"false",f=a.error||function(){},g=a.auth_key||V.getAuthKey(),h=a.cipher_key,i=a.channel,j=a.channel_group,l=a.start,m=a.end,o=a.include_token,p=a.string_message_token||!1,q={},r=za();return i||j?c?V.getSubscribeKey()?(q.stringtoken="true",q.count=d,q.reverse=e,q.auth=g,j&&(q["channel-group"]=j,i||(i=",")),r&&(q.callback=r),l&&(q.start=l),m&&(q.end=m),o&&(q.include_token="true"),p&&(q.string_message_token="true"),void W.fetchHistory(i,{callback:r,data:b(q),success:function(a){if("object"==("undefined"==typeof a?"undefined":k(a))&&a.error)return void f({message:a.message,payload:a.payload});for(var b=a[0],d=[],e=0;e<b.length;e++)if(o){var g=n(b[e].message,h),i=b[e].timetoken;try{d.push({message:JSON.parse(g),timetoken:i})}catch(j){d.push({message:g,timetoken:i})}}else{var g=n(b[e],h);try{d.push(JSON.parse(g))}catch(j){d.push(g)}}c([d,a[1],a[2]])},fail:function(a){G(a,f)}})):xa("Missing Subscribe Key"):xa("Missing Callback"):xa("Missing Channel")},replay:function(a,c){var c=c||a.callback||function(){},d=a.auth_key||V.getAuthKey(),e=a.source,f=a.destination,g=a.error||a.error||function(){},h=a.stop,i=a.start,j=a.end,k=a.reverse,l=a.limit,m=za(),n={};return e?f?V.getPublishKey()?V.getSubscribeKey()?("0"!=m&&(n.callback=m),h&&(n.stop="all"),k&&(n.reverse="true"),i&&(n.start=i),j&&(n.end=j),l&&(n.count=l),n.auth=d,void W.fetchReplay(e,f,{callback:m,success:function(a){F(a,c,g)},fail:function(){c([0,"Disconnected"])},data:b(n)})):xa("Missing Subscribe Key"):xa("Missing Publish Key"):xa("Missing Destination Channel"):xa("Missing Source Channel")},auth:function(a){V.setAuthKey(a),da()},time:function(a){var c=za(),d={uuid:Ca,auth:V.getAuthKey()};Da&&(d.instanceid=Ea),W.fetchTime(c,{callback:c,data:b(d),success:function(b){a(b[0])},fail:function(){a(0)}})},publish:function(a,c){var d=a.message;if(!d)return xa("Missing Message");var e,c=c||a.callback||d.callback||a.success||function(){},f=a.channel||d.channel,g=a.auth_key||V.getAuthKey(),h=a.cipher_key,i=a.error||d.error||function(){},j=a.post||!1,k="store_in_history"in a?a.store_in_history:!0,m=za(),n="push",o={uuid:Ca,auth:g};return a.prepend&&(n="unshift"),f?V.getPublishKey()?V.getSubscribeKey()?(d.getPubnubMessage&&(d=d.getPubnubMessage()),d=JSON.stringify(l(d,h)),e=[W.getStandardOrigin(),"publish",V.getPublishKey(),V.getSubscribeKey(),0,q["default"].encode(f),m,q["default"].encode(d)],k||(o.store="0"),Da&&(o.instanceid=Ea),ea[n]({callback:m,url:e,data:b(o),fail:function(a){G(a,i),s(1)},success:function(a){F(a,c,i),s(1)},mode:j?"POST":"GET"}),void s()):xa("Missing Subscribe Key"):xa("Missing Publish Key"):xa("Missing Channel")},unsubscribe:function(a,b){var c=a.channel,d=a.channel_group,e=a.auth_key||V.getAuthKey(),b=b||a.callback||function(){},f=a.error||function(){};if(la=0,ka=1,!c&&!d)return xa("Missing Channel or Channel Group");if(!V.getSubscribeKey())return xa("Missing Subscribe Key");if(c){var g=q["default"].isArray(c)?c:(""+c).split(","),h=[],i=[];if(q["default"].each(g,function(a){na[a]&&h.push(a)}),0==h.length)return void b({action:"leave"});q["default"].each(h,function(a){i.push(a+w)}),q["default"].each(h.concat(i),function(a){a in na&&(na[a]=0),a in pa&&delete pa[a]});var j=!0;u&&(j=Ja.LEAVE(h.join(","),0,e,b,f)),j||b({action:"leave"})}if(d){var k=q["default"].isArray(d)?d:(""+d).split(","),l=[],m=[];if(q["default"].each(k,function(a){oa[a]&&l.push(a)}),0==l.length)return void b({action:"leave"});q["default"].each(l,function(a){m.push(a+w)}),q["default"].each(l.concat(m),function(a){a in oa&&(oa[a]=0),a in pa&&delete pa[a]});var j=!0;u&&(j=Ja.LEAVE_GROUP(l.join(","),0,e,b,f)),j||b({action:"leave"})}da()},subscribe:function(a,c){function d(a){a?q["default"].timeout(da,D):(W.shiftStandardOrigin(!0),W.shiftSubscribeOrigin(!0),q["default"].timeout(function(){Ja.time(d)},B)),y(function(b){return a&&b.disconnected?(b.disconnected=0,b.reconnect(b.name)):void(a||b.disconnected||(b.disconnected=1,b.disconnect(b.name)))}),t(function(b){return a&&b.disconnected?(b.disconnected=0,b.reconnect(b.name)):void(a||b.disconnected||(b.disconnected=1,b.disconnect(b.name)))})}function e(){var a=za(),c=f(na).join(","),h=g(oa).join(",");if(c||h){c||(c=","),K();var i=b({uuid:Ca,auth:V.getAuthKey()});h&&(i["channel-group"]=h);var j=JSON.stringify(pa);j.length>2&&(i.state=JSON.stringify(pa)),ra&&(i.heartbeat=ra),Da&&(i.instanceid=Ea),r(),ja=P({timeout:C,callback:a,fail:function(a){a&&a.error&&a.service?(G(a,o),d(!1)):Ja.time(function(b){!b&&G(a,o),d(b)})},data:b(i),url:[W.getSubscribeOrigin(),"subscribe",V.getSubscribeKey(),q["default"].encode(c),a,la],success:function(a){if(!a||"object"==("undefined"==typeof a?"undefined":k(a))&&"error"in a&&a.error)return o(a),q["default"].timeout(da,B);if(p(a[1]),la=!la&&ka&&Aa.get(V.getSubscribeKey())||a[1],y(function(a){a.connected||(a.connected=1,a.connect(a.name))}),t(function(a){a.connected||(a.connected=1,a.connect(a.name))}),ma&&!ka)return la=0,ma=!1,Aa.set(V.getSubscribeKey(),0),void q["default"].timeout(e,D);z&&(la=1e4,z=0),Aa.set(V.getSubscribeKey(),a[1]);var b=function(){var b="",c="";a.length>3?(b=a[3],c=a[2]):b=a.length>2?a[2]:q["default"].map(f(na),function(b){return q["default"].map(Array(a[0].length).join(",").split(","),function(){return b})}).join(",");var d=b.split(","),e=c?c.split(","):[];return function(){var a=d.shift()||ia,b=e.shift(),c={};b?(a&&a.indexOf("-pnpres")>=0&&b.indexOf("-pnpres")<0&&(b+="-pnpres"),c=oa[b]||na[b]||{callback:function(){}}):c=na[a];var f=[c.callback||ha,a.split(w)[0]];return b&&f.push(b.split(w)[0]),f}}(),c=L(+a[1]);q["default"].each(a[0],function(d){var e=b(),f=n(d,na[e[1]]?na[e[1]].cipher_key:null);e[0]&&e[0](f,a,e[2]||e[1],c,e[1])}),q["default"].timeout(e,D)}})}}var h=a.channel,i=a.channel_group,c=c||a.callback,c=c||a.message,j=a.connect||function(){},l=a.reconnect||function(){},m=a.disconnect||function(){},o=a.error||o||function(){},p=a.idle||function(){},s=a.presence||0,x=a.noheresync||0,z=a.backfill||0,A=a.timetoken||0,C=a.timeout||Y,D=a.windowing||X,E=a.state,F=a.heartbeat||a.pnexpires,H=a.heartbeat_interval,I=a.restore||ka;return V.setAuthKey(a.auth_key||V.getAuthKey()),ka=I,la=A,h||i?c?V.getSubscribeKey()?((F||0===F||H||0===H)&&Ja.set_heartbeat(F,H),h&&q["default"].each((h.join?h.join(","):""+h).split(","),function(d){var e=na[d]||{};na[ia=d]={name:d,connected:e.connected,disconnected:e.disconnected,subscribed:1,callback:ha=c,cipher_key:a.cipher_key,connect:j,disconnect:m,reconnect:l},E&&(d in E?pa[d]=E[d]:pa[d]=E),s&&(Ja.subscribe({channel:d+w,callback:s,restore:I}),e.subscribed||x||Ja.here_now({channel:d,data:b({uuid:Ca,auth:V.getAuthKey()}),callback:function(a){q["default"].each("uuids"in a?a.uuids:[],function(b){s({action:"join",uuid:b,timestamp:Math.floor(q["default"].rnow()/1e3),occupancy:a.occupancy||1},a,d)})}}))}),i&&q["default"].each((i.join?i.join(","):""+i).split(","),function(d){var e=oa[d]||{};oa[d]={name:d,connected:e.connected,disconnected:e.disconnected,subscribed:1,callback:ha=c,cipher_key:a.cipher_key,connect:j,disconnect:m,reconnect:l},s&&(Ja.subscribe({channel_group:d+w,callback:s,restore:I,auth_key:V.getAuthKey()}),e.subscribed||x||Ja.here_now({channel_group:d,data:b({uuid:Ca,auth:V.getAuthKey()}),callback:function(a){q["default"].each("uuids"in a?a.uuids:[],function(b){s({action:"join",uuid:b,timestamp:Math.floor(q["default"].rnow()/1e3),occupancy:a.occupancy||1},a,d)})}}))}),da=function(){K(),q["default"].timeout(e,D)},u?void da():v.push(da)):xa("Missing Subscribe Key"):xa("Missing Callback"):xa("Missing Channel")},here_now:function(a,c){var c=a.callback||c,d=a.debug,e=a.error||function(){},f=a.auth_key||V.getAuthKey(),g=a.channel,h=a.channel_group,i=za(),j="uuids"in a?a.uuids:!0,k=a.state,l={uuid:Ca,auth:f};if(j||(l.disable_uuids=1),k&&(l.state=1),!c)return xa("Missing Callback");if(!V.getSubscribeKey())return xa("Missing Subscribe Key");var m=[W.getStandardOrigin(),"v2","presence","sub_key",V.getSubscribeKey()];g&&m.push("channel")&&m.push(q["default"].encode(g)),"0"!=i&&(l.callback=i),h&&(l["channel-group"]=h,!g&&m.push("channel")&&m.push(",")),Da&&(l.instanceid=Ea),P({callback:i,data:b(l),success:function(a){F(a,c,e)},fail:function(a){G(a,e)},debug:d,url:m})},where_now:function(a,c){var c=a.callback||c,d=a.error||function(){},e=a.auth_key||V.getAuthKey(),f=za(),g=a.uuid||Ca,h={auth:e};return c?V.getSubscribeKey()?("0"!=f&&(h.callback=f),Da&&(h.instanceid=Ea),void P({callback:f,data:b(h),success:function(a){F(a,c,d)},fail:function(a){G(a,d)},url:[W.getStandardOrigin(),"v2","presence","sub_key",V.getSubscribeKey(),"uuid",q["default"].encode(g)]})):xa("Missing Subscribe Key"):xa("Missing Callback")},state:function La(a,c){var d,c=a.callback||c||function(a){},e=a.error||function(){},f=a.auth_key||V.getAuthKey(),g=za(),La=a.state,h=a.uuid||Ca,i=a.channel,j=a.channel_group,k=b({auth:f});return V.getSubscribeKey()?h?i||j?("0"!=g&&(k.callback=g),"undefined"!=typeof i&&na[i]&&na[i].subscribed&&La&&(pa[i]=La),"undefined"!=typeof j&&oa[j]&&oa[j].subscribed&&(La&&(pa[j]=La),k["channel-group"]=j,i||(i=",")),k.state=JSON.stringify(La),Da&&(k.instanceid=Ea),d=La?[W.getStandardOrigin(),"v2","presence","sub-key",V.getSubscribeKey(),"channel",i,"uuid",h,"data"]:[W.getStandardOrigin(),"v2","presence","sub-key",V.getSubscribeKey(),"channel",i,"uuid",q["default"].encode(h)],void P({callback:g,data:b(k),success:function(a){F(a,c,e)},fail:function(a){G(a,e)},url:d})):xa("Missing Channel"):xa("Missing UUID"):xa("Missing Subscribe Key")},grant:function(a,c){var c=a.callback||c,d=a.error||function(){},e=a.channel||a.channels,f=a.channel_group,g=za(),h=a.ttl,j=a.read?"1":"0",k=a.write?"1":"0",l=a.manage?"1":"0",m=a.auth_key||a.auth_keys;if(!c)return xa("Missing Callback");if(!V.getSubscribeKey())return xa("Missing Subscribe Key");if(!V.getPublishKey())return xa("Missing Publish Key");if(!aa)return xa("Missing Secret Key");var n=Math.floor((new Date).getTime()/1e3),o=V.getSubscribeKey()+"\n"+V.getPublishKey()+"\ngrant\n",p={w:k,r:j,timestamp:n};a.manage&&(p.m=l),q["default"].isArray(e)&&(e=e.join(",")),q["default"].isArray(m)&&(m=m.join(",")),"undefined"!=typeof e&&null!=e&&e.length>0&&(p.channel=e),"undefined"!=typeof f&&null!=f&&f.length>0&&(p["channel-group"]=f),"0"!=g&&(p.callback=g),(h||0===h)&&(p.ttl=h),m&&(p.auth=m),p=b(p),m||delete p.auth,o+=i(p);var r=ba(o,aa);r=r.replace(/\+/g,"-"),r=r.replace(/\//g,"_"),p.signature=r,P({callback:g,data:p,success:function(a){F(a,c,d)},fail:function(a){G(a,d)},url:[W.getStandardOrigin(),"v1","auth","grant","sub-key",V.getSubscribeKey()]})},mobile_gw_provision:function(a){var b,c=a.callback||function(){},d=a.auth_key||V.getAuthKey(),e=a.error||function(){},f=za(),g=a.channel,h=a.op,i=a.gw_type,j=a.device_id;if(!j)return xa("Missing Device ID (device_id)");if(!i)return xa("Missing GW Type (gw_type: gcm or apns)");if(!h)return xa("Missing GW Operation (op: add or remove)");if(!g)return xa("Missing gw destination Channel (channel)");if(!V.getPublishKey())return xa("Missing Publish Key");if(!V.getSubscribeKey())return xa("Missing Subscribe Key");var k={uuid:Ca,auth:d,type:i};b=[W.getStandardOrigin(),"v1/push/sub-key",V.getSubscribeKey(),"devices",j],"add"==h?k.add=g:"remove"==h&&(k.remove=g),Da&&(k.instanceid=Ea),P({callback:f,data:k,success:function(a){F(a,c,e)},fail:function(a){G(a,e)},url:b})},audit:function(a,c){var c=a.callback||c,d=a.error||function(){},e=a.channel,f=a.channel_group,g=a.auth_key,h=za();if(!c)return xa("Missing Callback");if(!V.getSubscribeKey())return xa("Missing Subscribe Key");if(!V.getPublishKey())return xa("Missing Publish Key");if(!aa)return xa("Missing Secret Key");var j=Math.floor((new Date).getTime()/1e3),k=V.getSubscribeKey()+"\n"+V.getPublishKey()+"\naudit\n",l={timestamp:j};"0"!=h&&(l.callback=h),"undefined"!=typeof e&&null!=e&&e.length>0&&(l.channel=e),"undefined"!=typeof f&&null!=f&&f.length>0&&(l["channel-group"]=f),g&&(l.auth=g),l=b(l),g||delete l.auth,k+=i(l);var m=ba(k,aa);m=m.replace(/\+/g,"-"),m=m.replace(/\//g,"_"),l.signature=m,P({callback:h,data:l,success:function(a){F(a,c,d)},fail:function(a){G(a,d)},url:[W.getStandardOrigin(),"v1","auth","audit","sub-key",V.getSubscribeKey()]})},revoke:function(a,b){a.read=!1,a.write=!1,Ja.grant(a,b)},set_uuid:function(a){Ca=a,da()},get_uuid:function(){return Ca},isArray:function(a){return q["default"].isArray(a)},get_subscribed_channels:function(){return f(na,!0)},presence_heartbeat:function(a){var c=a.callback||function(){},d=a.error||function(){},e=za(),h={uuid:Ca,auth:V.getAuthKey()},i=JSON.stringify(pa);i.length>2&&(h.state=JSON.stringify(pa)),ra>0&&320>ra&&(h.heartbeat=ra),"0"!=e&&(h.callback=e);var j=q["default"].encode(f(na,!0).join(",")),k=g(oa,!0).join(",");j||(j=","),k&&(h["channel-group"]=k),Da&&(h.instanceid=Ea),P({callback:e,data:b(h),url:[W.getStandardOrigin(),"v2","presence","sub-key",V.getSubscribeKey(),"channel",j,"heartbeat"],success:function(a){F(a,c,d)},fail:function(a){G(a,d)}})},stop_timers:function(){clearTimeout(N),clearTimeout(O),clearTimeout(qa)},shutdown:function(){Ja.stop_timers(),Fa&&Fa()},xdr:P,ready:h,db:Aa,uuid:q["default"].generateUUID,map:q["default"].map,each:q["default"].each,"each-channel":y,grep:q["default"].grep,offline:function(){K(1,{message:"Offline. Please check your network settings."})},supplant:q["default"].supplant,now:q["default"].rnow,unique:e,updater:q["default"].updater};return Ca||(Ca=Ja.uuid()),Ea||(Ea=Ja.uuid()),Aa.set(V.getSubscribeKey()+"uuid",Ca),N=q["default"].timeout(I,B),O=q["default"].timeout(J,Z),qa=q["default"].timeout(r,(sa-3)*B),M(),Ja}var k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},l=c(5),m=d(l),n=c(6),o=d(n),p=c(7),q=d(p),r=c(3),s=c(8),t=1,u=!1,v=[],w="-pnpres",x=10,y=15e3,z=310,A=60,B=1e3,C=5,D=30,E=r.version;a.exports={PN_API:j,unique:e,PNmessage:i,DEF_TIMEOUT:y,timeout:q["default"].timeout,build_url:q["default"].buildURL,each:q["default"].each,uuid:q["default"].generateUUID,URLBIT:s.URLBIT,grep:q["default"].grep,supplant:q["default"].supplant,now:q["default"].rnow,updater:q["default"].updater,map:q["default"].map}},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{"default":a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=c(6),h=(d(g),c(7)),i=d(h),j=function(){function a(b,c){var d=arguments.length<=2||void 0===arguments[2]?!1:arguments[2],f=arguments.length<=3||void 0===arguments[3]?"pubsub.pubnub.com":arguments[3];e(this,a),this._xdr=b,this._keychain=c,this._maxSubDomain=20,this._currentSubDomain=Math.floor(Math.random()*this._maxSubDomain),this._providedFQDN=(d?"https://":"http://")+f,this.shiftStandardOrigin(!1),this.shiftSubscribeOrigin(!1)}return f(a,[{key:"nextOrigin",value:function(a){if(-1===this._providedFQDN.indexOf("pubsub."))return this._providedFQDN;var b=void 0;return a?b=i["default"].generateUUID().split("-")[0]:(this._currentSubDomain=this._currentSubDomain+1,this._currentSubDomain>=this._maxSubDomain&&(this._currentSubDomain=1),b=this._currentSubDomain.toString()),this._providedFQDN.replace("pubsub","ps"+b)}},{key:"shiftStandardOrigin",value:function(){var a=arguments.length<=0||void 0===arguments[0]?!1:arguments[0];return this._standardOrigin=this.nextOrigin(a),this._standardOrigin}},{key:"shiftSubscribeOrigin",value:function(){var a=arguments.length<=0||void 0===arguments[0]?!1:arguments[0];return this._subscribeOrigin=this.nextOrigin(a),this._subscribeOrigin}},{key:"fetchHistory",value:function(a,b){var c=b.data,d=b.callback,e=b.success,f=b.fail,g=[this.getStandardOrigin(),"v2","history","sub-key",this._keychain.getSubscribeKey(),"channel",i["default"].encode(a)];this._xdr({data:c,callback:d,success:e,fail:f,url:g})}},{key:"fetchReplay",value:function(a,b,c){var d=c.data,e=c.callback,f=c.success,g=c.fail,h=[this.getStandardOrigin(),"v1","replay",this._keychain.getPublishKey(),this._keychain.getSubscribeKey(),a,b];this._xdr({data:d,callback:e,success:f,fail:g,url:h})}},{key:"fetchTime",value:function(a,b){var c=b.data,d=b.callback,e=b.success,f=b.fail,g=[this.getStandardOrigin(),"time",a];this._xdr({data:c,callback:d,success:e,fail:f,url:g})}},{key:"getOrigin",value:function(){return this._providedFQDN}},{key:"getStandardOrigin",value:function(){return this._standardOrigin}},{key:"getSubscribeOrigin",value:function(){return this._subscribeOrigin}}]),a}();b["default"]=j},function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=function(){function a(){c(this,a)}return d(a,[{key:"setSubscribeKey",value:function(a){return this._subscribeKey=a,this}},{key:"setPublishKey",value:function(a){return this._publishKey=a,this}},{key:"setAuthKey",value:function(a){return this._authKey=a,this}},{key:"getSubscribeKey",value:function(){return this._subscribeKey}},{key:"getPublishKey",value:function(){return this._publishKey}},{key:"getAuthKey",value:function(){return this._authKey}}]),a}();b["default"]=e},function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=c(8),h=/{([\w\-]+)}/g,i=function(){function a(){d(this,a)}return f(a,null,[{key:"rnow",value:function(){return+new Date}},{key:"encode",value:function(a){return encodeURIComponent(a)}},{key:"isArray",value:function(a){return!!a&&"string"!=typeof a&&(Array.isArray&&Array.isArray(a)||"number"==typeof a.length)}},{key:"supplant",value:function(a,b){return a.replace(h,function(a,c){return b[c]||a})}},{key:"buildURL",value:function(a,b){var c=a.join(g.URLBIT),d=[];return b?(this.each(b,function(a,b){var c="object"===("undefined"==typeof b?"undefined":e(b))?JSON.stringify(b):b;"undefined"!=typeof b&&null!==b&&this.encode(c).length>0&&d.push(a+"="+this.encode(c))}),c+="?"+d.join(g.PARAMSBIT)):c}},{key:"each",value:function(a,b){if(a&&b)if(this.isArray(a))for(var c=0,d=a.length;d>c;)b.call(a[c],a[c],c++);else for(var c in a)a.hasOwnProperty&&a.hasOwnProperty(c)&&b.call(a[c],c,a[c])}},{key:"updater",value:function(a,b){var c,d=0,e=function f(){d+b>this.rnow()?(clearTimeout(c),c=setTimeout(f,b)):(d=this.rnow(),a())};return e}},{key:"grep",value:function(a,b){var c=[];return this.each(a||[],function(a){b(a)&&c.push(a);
}),c}},{key:"timeout",value:function(a,b){return"undefined"!=typeof setTimeout?setTimeout(a,b):void 0}},{key:"generateUUID",value:function(a){var b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)});return a&&a(b),b}},{key:"map",value:function(a,b){var c=[];return this.each(a||[],function(a,d){c.push(b(a,d))}),c}},{key:"pamEncode",value:function(a){return encodeURIComponent(a).replace(/[!'()*~]/g,function(a){return"%"+a.charCodeAt(0).toString(16).toUpperCase()})}}]),a}();b["default"]=i},function(a,b){a.exports={PARAMSBIT:"&",URLBIT:"/"}}])});